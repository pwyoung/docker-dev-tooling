#!/bin/bash

# Run the docker container.
#
# Map ~/home_dev to /home/dev so that files can be edited in the host or container
#
# Start the SSH server.
#
# If no args are given, log into it.
# If args are given, then run them

IMAGE="dev-tools:latest"

# Docker run args
DARGS=""

# Map the SSH server port
#
# Only allow local connections
#DARGS+=" -p 127.0.0.1:2222:22/tcp"
#
# Allow connections from outside this host
DARGS+=" -p 2222:22"

# Since we can only run one of these, might as well name it
DARGS+=" --name dev-sshd"

# Run with an interactive terminal
DARGS+=" -t -i"

# Remove the container when it exits
DARGS+=" --rm"

# Share files here
DARGS+=" -v ${HOME}/home_dev:/home/dev"

# Set hostname
DARGS+=" --hostname dev-sshd"

# Specify the command to run
if [ $# -eq 0 ]; then
    CMD="bash -l"
else
    CMD="$@"
fi

# Start SSH server and then run the command
docker run $DARGS $IMAGE bash -c "sudo service ssh start && service ssh status && $CMD"
